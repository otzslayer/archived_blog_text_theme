---
title: Hyperband
tags: [hpo, hyperband, sha, multi-fidelity]
category: ML
aside:
  toc: true
show_category: true
---

π“„ Li, Lisha, et al. "Hyperband: A novel bandit-based approach to hyperparameter optimization." *The Journal of Machine Learning Research* 18.1 (2017): 6765-6816.

<!--more-->


## λ“¤μ–΄κ°€λ©°

### Successive Halving Algorithmμ λ¬Έμ 

Hyperbandμ κΈ°λ°μ΄ λλ” [Successive Halving Algorithm](https://otzslayer.github.io/ml/2022/12/24/successive-halving-algorithm.html)μ€ κ°„λ‹¨ν• μ»¨μ…‰μ„ κ°–κ³  μμΌλ©΄μ„λ„ μ‹¤μ  μ„±λ¥λ„ μΆ‹μ€ μ•κ³ λ¦¬μ¦μ…λ‹λ‹¤. ν•μ§€λ§ **μ•κ³ λ¦¬μ¦μ— μ…λ ¥κ°’μΌλ΅ μ‚¬μ©λλ” μμ‚° $B$μ™€ ν•μ΄νΌνλΌλ―Έν„° μ„¤μ •κ°’ κ°μ $n$μ„ μ–΄λ–»κ² μ„¤μ •ν•λλƒμ— λ”°λΌ μ•κ³ λ¦¬μ¦μ λ°©μ‹μ΄ ν¬κ² λ‹¬λΌμ§„λ‹¤**λ” λ¬Έμ κ°€ μμµλ‹λ‹¤.

SHAλ” κ³ μ •λ $B$ κ°’μ— λ€ν•΄μ„ $n$ κ°’μ ν¬κΈ°μ— λ”°λΌ μ•κ³ λ¦¬μ¦μ΄ λ§¤μ° λ‹¤λ¥Έ κ²°κ³Όλ¥Ό λ§λ“­λ‹λ‹¤. $n$ μ΄ ν΄ μλ΅ λ¨λΈμ μ¤‘κ°„ μ†μ‹¤ ν•¨μλ¥Ό κ³„μ‚°ν•λ” νμκ°€ λ§μ•„μ§‘λ‹λ‹¤. μ •ν™•ν•κ²λ” $\lceil \log_2(n) \rceil$ λ² κ³„μ‚°ν•κΈ° λ•λ¬Έμ…λ‹λ‹¤. λ§¤λ² λ¨λΈμ μ¤‘κ°„ μ†μ‹¤ ν•¨μλ¥Ό κ³„μ‚°ν•¨μ— μμ–΄μ„ ν•™μµ Epoch μλ” λ‹¤μκ³Ό κ°™μµλ‹λ‹¤.

$$
\text{\#Epoch} = \left\lfloor \frac{B}{|S_k| \lceil \log_2(n) \rceil} \right\rfloor
$$

λ”°λΌμ„ $n$ μ΄ ν΄ μλ΅ ν• λ²μ— ν•™μµν•λ” Epoch μλ” μ¤„μ–΄λ“¤κ² λ©λ‹λ‹¤. λ§μ•½ $n$ μ΄ ν¬λ‹¤λ©΄ μ—¬λ¬ κ°μ ν•μ΄νΌνλΌλ―Έν„° μ„¤μ •μ„ ν…μ¤νΈν•  μ μμ§€λ§ κ°κ°μ„ μ—¬λ¬ λ² ν•™μµν•  μλ” μ—†μµλ‹λ‹¤. λ°λ€λ΅ ν…μ¤νΈν•λ” ν•μ΄νΌνλΌλ―Έν„° μ„¤μ •μ΄ μ λ‹¤λ©΄ μ—¬λ¬ λ² ν•™μµν•μ—¬ μ£Όμ–΄μ§„ ν•μ΄νΌνλΌλ―Έν„° μ¤‘ μµμ κ°’μ„ μ°Ύμ•„λ‚Ό μ μκ² μ£ . κ²°κµ­ **$B/n$ μ κ°’μ— λ”°λΌμ„ Exploration-Exploitation Trade-offκ°€ λ°μƒ**ν•κ³ , μ΄λ” μ•κ³ λ¦¬μ¦μ κ²°κ³Όμ— μ§€λ€ν• μν–¥μ„ λ―ΈμΉ©λ‹λ‹¤.

>   π”¬**μ΅°κΈ λ” μμ„Έν•κ²!**
>
>   -   λ§μ•½ $n$μ κ°’μ΄ μ»¤μ§„λ‹¤λ©΄ μ—¬λ¬ κ°μ ν•μ΄νΌνλΌλ―Έν„° μ„¤μ •μ„ ν…μ¤νΈν•μ§€λ§ μ—¬λ¬ λ² ν•™μµν•μ§€ λ»ν•λ―€λ΅ **Exploration**μ— μΉμ¤‘ν•κ² λ©λ‹λ‹¤.
>   -   λ°λ€λ΅ $n$μ κ°’μ΄ μ‘μ•„μ§„λ‹¤λ©΄ μ μ€ μμ ν•μ΄νΌνλΌλ―Έν„° μ„¤μ •μ„ κΉκ² ν•™μµν•κ² λλ―€λ΅ **Exploitation**μ— μΉμ¤‘ν•κ² λ©λ‹λ‹¤.

κ·Έλ ‡λ‹¤κ³  μ μ ν• $n$ κ°’μ„ λ―Έλ¦¬ μ• μλ„ μ—†μµλ‹λ‹¤. μΌλ°μ μΌλ΅ λ¨λΈμ΄ μ–΄λ– ν• ν•™μµ κ³΅μ„ μ„ κ·Έλ¦¬λ”μ§€ λ¨λ¥΄λ” μƒνƒμ΄κΈ° λ•λ¬ΈμΈλ°μ”. μ–΄λ–¤ κ²½μ°μ—λ” λ¨λΈμ ν•μ΄νΌνλΌλ―Έν„°λ¥Ό λ°”κΎΈλ”λΌλ„ μ„±λ¥μ΄ ν¬κ² λ³€ν•μ§€ μ•μ•„ μ μ€ μμ ν•μ΄νΌνλΌλ―Έν„°λ§ ν…μ¤νΈν•λ©΄ λ  μλ„ μμµλ‹λ‹¤. λ°λ€λ΅ ν•μ΄νΌνλΌλ―Έν„°μ κ°’μ— λ”°λΌ μ„±λ¥μ΄ λ§μ΄ μΆμ°λκ±°λ‚ λ¨λΈμ μλ ΄μ΄ μ²«λ¨Έλ¦¬μ— λΉ λ¥΄κ² μ΄λ£¨μ–΄μ§€λ” κ²½μ°μ—” λ§¤μ° λ‹¤μ–‘ν• ν•μ΄νΌνλΌλ―Έν„°λ¥Ό ν…μ¤νΈν•΄μ•Ό ν•λ―€λ΅ ν° $n$ κ°’μ„ μ„¤μ •ν•΄μ•Ό ν•  μλ„ μμµλ‹λ‹¤.

### μ•„μ΄λ””μ–΄

SHAμ—μ„ λ°μƒ κ°€λ¥ν• λ¬Έμ λ” κ³ μ •λ μμ‚° $B$ μ— λ€ν•΄μ„ **ν•μ΄νΌνλΌλ―Έν„° μ„¤μ • κ°μμΈ $n$ λ§μ €λ„ μ•κ³ λ¦¬μ¦μ μ…λ ¥κ°’μΌλ΅ ν™μ©ν•κΈ° λ•λ¬Έ**μ…λ‹λ‹¤. Hyperbandλ” μ΄ λ¬Έμ λ¥Ό ν•΄κ²°ν•κΈ° μ„ν•΄ $n$ μ„ μ…λ ¥κ°’μΌλ΅ λ°›μ§€ μ•κ³  μμ²΄μ μΌλ΅ μ„¤μ •λλ„λ΅ ν–μµλ‹λ‹¤. λν• μ „μ²΄μ— λ€ν• μμ‚°μ„ λ¨Όμ € μ„¤μ •ν•μ§€ μ•κ³  ν•λ‚μ ν•μ΄νΌνλΌλ―Έν„° μ„¤μ •μ— λ€ν• μμ‚° $R$ μ„ μ…λ ¥κ°’μΌλ΅ λ°›μµλ‹λ‹¤. κΈ°μ΅΄μ $B$ λ” μμ²΄μ μΌλ΅ μ„¤μ •λλ” ν•μ΄νΌνλΌλ―Έν„° μ„¤μ • κ°μμ— $R$ μ„ κ³±ν•΄μ„ μ–»κ² λ©λ‹λ‹¤. 

λΏλ§ μ•„λ‹λΌ $R$ κ°’μ΄ μ»¤μ§ μλ΅ λ‹¤μ–‘ν• ν•μ΄νΌνλΌλ―Έν„° μ„¤μ •μ— λ€ν•΄ ν…μ¤νΈν•  μ μκ² λλ©°, κ°κ°μ μ„¤μ •μ„ κΉκ² ν•™μµν•  μ μκ² λμ–΄ SHAμ—μ„ λ°μƒν•λ” νΈλ μ΄λ“μ¤ν”„ λ¬Έμ λ¥Ό μ–΄λ μ •λ„ μ™„ν™”ν•  μ μμµλ‹λ‹¤.

## Hyperband

<center>
<img src="https://i.ibb.co/V3cNRDv/hyperband-algorithm.png" alt="image-20221124151137247" style="zoom:50%;" />
</center>

Hyperbandλ” λ‹¤μ μμ„λ€λ΅ μ‘λ™ν•©λ‹λ‹¤.

-   ν•μ΄νΌνλΌλ―Έν„°λ§λ‹¤μ μμ‚° $R$, μ„¤μ •κ°’ μ¤‘ κ°€μ Έκ°€μ•Ό ν•  λΉ„μ¨ $\eta$λ¥Ό μ…λ ¥κ°’μΌλ΅ λ°›μµλ‹λ‹¤. μ΄λ• $\eta$μ κΈ°λ³Έκ°’μ€ 3μ…λ‹λ‹¤.
    -   λ…Όλ¬Έμ— λ”°λ¥΄λ©΄ μ μ ν• $\eta$ λ” μν•™μ μΌλ΅ $\eta = e$ λΌκ³  ν•©λ‹λ‹¤. μ‹¤μ λ΅λ” $\eta$λ” 3μ΄λ‚ 4λ¥Ό μ¶”μ²ν•κ³  μμµλ‹λ‹¤.

-   μ…λ ¥κ°’μ„ μ΄μ©ν•΄ SHAλ¥Ό μν–‰ν•  νμ (λ³Έ λ…Όλ¬Έμ—μ„λ” **bracket**μ΄λΌκ³  λ¶€λ¦„)μ™€ μ΄ μμ‚° $B$λ¥Ό κ³„μ‚°ν•μ—¬ μ΄κΈ°ν™”ν•©λ‹λ‹¤.
    -   $s_\text{max} = \lfloor \log_\eta(R) \rfloor$, $B = (s_\text{max}+1) R$
-   κ° $s \in \{ s_\text{max}, s_\text{max}-1, \cdots, 0 \}$ λ§λ‹¤ λ‹¤μμ SHAλ¥Ό μν–‰ν•©λ‹λ‹¤.
    -   μµμ΄ ν•μ΄νΌνλΌλ―Έν„° μ„¤μ • κ°μμ™€ ν•™μµ Epoch μλ¥Ό κ³„μ‚°ν•©λ‹λ‹¤.
        -   $n = \lceil \frac{B}{R} \frac{\eta^s}{(s+1)} \rceil$, $r = R\eta^{-s}$
            -   μ΄λ• ν•μ΄νΌνλΌλ―Έν„° μ„¤μ •μ€ νΉμ • λ¶„ν¬μ—μ„ i.i.dν•κ² μƒν”λ§ν•©λ‹λ‹¤. 
        -   SHAλ¥Ό μν–‰ν•©λ‹λ‹¤.
            -   κ° λ‹¨κ³„λ§λ‹¤μ ν•μ΄νΌνλΌλ―Έν„° μ„¤μ • μλ” $n_i = \lfloor n \eta^{-1} \rfloor$, ν•™μµ Epoch μλ” $r_i = r \eta^i$ μ…λ‹λ‹¤.
            -   λ¨λ“  ν•μ΄νΌνλΌλ―Έν„° μ„¤μ •μ— λ€ν•΄ $r_i$ λ§νΌ ν•™μµν•μ—¬ μ„±λ¥μ΄ μΆ‹μ€ $\lfloor n_i / \eta \rfloor$ κ° λ§νΌμ ν•μ΄νΌνλΌλ―Έν„° μ„¤μ •μ„ μ €μ¥ν•©λ‹λ‹¤.
            -   μ €μ¥ν• ν•μ΄νΌνλΌλ―Έν„° μ„¤μ •μ— λ€ν•΄ μ„ κ³Όμ •μ„ λ°λ³µν•©λ‹λ‹¤. 
-   λ¨λ“  κ²°κ³Όμ— λ€ν•΄μ„ κ°€μ¥ μ„±λ¥μ΄ μΆ‹μ€ ν•μ΄νΌνλΌλ―Έν„° μ„¤μ •μ„ λ°ν™ν•©λ‹λ‹¤.

### μ‹¤μ  μμ‹

μ‹¤μ  κ°’μ„ λ€μ…ν•μ—¬ Hyperbandκ°€ μ–΄λ–»κ² μ‘λ™ν•λ”μ§€ μ‚΄ν΄λ³΄λ„λ΅ ν•κ² μµλ‹λ‹¤. $R = 81, \eta = 3$μΌλ΅ λ‘κ² μµλ‹λ‹¤. κ·Έλ ‡λ‹¤λ©΄ $s_\text{max} = \lfloor \log_\eta(R) \rfloor = 4$, $B = (s_\text{max}+1)R = 5 \cdot 81$μ΄ λ©λ‹λ‹¤. λ”°λΌμ„ Bracketμ μλ” 5κ°€ λ©λ‹λ‹¤. μ΄μ  κ°κ°μ Bracketμ— λ€ν•΄μ„ SHAλ¥Ό μν–‰ν•λ©΄ λλ”λ°μ”. $s$κ°€ ν° μμ„λ€λ΅ μν–‰ν•λ©΄ λ©λ‹λ‹¤.

1.   $s = s_\text{max} = 4$
     -   Bracketμ—μ„ ν…μ¤νΈν•  ν•μ΄νΌνλΌλ―Έν„° μ„¤μ •μ κ°μλ” $n = \lceil \frac{B}{R} \frac{\eta^4}{(s+1)} \rceil = 81$μ΄ λκ³ , ν•™μµν•  Epoch μλ” $r = R\eta^{-s} = 81 \cdot 3^{-4} = 1$μ΄ λ©λ‹λ‹¤.
     -   μ—¬κΈ°μ„λ¶€ν„° SHAλ¥Ό μ μ©ν•λ©΄ λλ”λ° SHAμ™€μ μ°¨μ΄λ” **λ‚¨κΈ°λ” ν•μ΄νΌνλΌλ―Έν„° μ„¤μ •μ μ**μ…λ‹λ‹¤. SHAλ” μ„¤μ •μ λ°μ„ λ‚¨κ²Όλ‹¤λ©΄ Hyperbandμ—μ„λ” $1/\eta$ λ§νΌμ„ λ‚¨κΉλ‹λ‹¤. λ”°λΌμ„ 1 Epoch ν•™μµ ν›„ μ„±λ¥μ΄ κ°€μ¥ μΆ‹μ€ $81 \cdot 1/\eta = 27$ κ°μ μ„¤μ •λ§μ„ λ‚¨κΉλ‹λ‹¤.
     -   27κ°μ μ„¤μ •μ— λ€ν•΄μ„ κΈ°μ΅΄ ν•™μµ Epoch μμ— $\eta$ λ§νΌμ„ κ³±ν• 3ν ν•™μµμ„ λ” ν•κ³  μ΄λ²μ—” 9κ°μ μ„¤μ •μ„ λ‚¨κΉλ‹λ‹¤. λ§μ§€λ§‰ ν•λ‚μ μ„¤μ •μ΄ λ‚¨μ„ λ•κΉμ§€ μ΄ κ³Όμ •μ„ λ°λ³µν•©λ‹λ‹¤.
2.   $s = 3$
     -   Bracketμ—μ„ ν…μ¤νΈν•  ν•μ΄νΌνλΌλ―Έν„° μ„¤μ • κ°μλ” $n = \lceil \frac{B}{R} \frac{\eta^3}{(s+1)} \rceil = 34$ κ°€ λκ³  ν•™μµν•  Epoch μλ” $r = R \eta^{-s} = 81 \cdot 3^{-3} = 3$ μ΄ λ©λ‹λ‹¤.
     -   κ·Έλ¬λ©΄ 3 Epochs λ§νΌ ν•™μµν•μ—¬ μ„±λ¥μ΄ κ°€μ¥ μΆ‹μ€ 11κ°λ¥Ό λ‚¨κΈ°κ³ , κ·Έ λ‹¤μ λ‹¤μ‹ 9νλ¥Ό ν•™μµν•μ—¬ 3κ°λ¥Ό, λ§μ§€λ§‰μΌλ΅ 27νλ¥Ό ν•™μµν•μ—¬ λ§μ§€λ§‰ ν• κ°λ§μ„ λ‚¨κΉλ‹λ‹¤.

μ΄ λ°©λ²•μΌλ΅ λ¨λ“  Bracketμ— λ€ν•΄ SHAλ¥Ό μν–‰ν•λ©΄ λ©λ‹λ‹¤. λ‹¤μ ν‘λ” λ¨λ“  Bracketμ— λ€ν•΄ κ° λ‹¨κ³„λ§λ‹¤ λ‡ κ°μ μ„¤μ •μ΄ λ‚¨κ³  λ‡ λ²μ ν•™μµμ„ μν–‰ν–λ”μ§€λ¥Ό λ³΄μ—¬μ¤λ‹λ‹¤.

<center>
<img src="https://i.ibb.co/QF0dL7F/hyperband-brackets.png" alt="image-20221204223413473" style="zoom:33%;" />
</center>

## λ‚κ°€λ©°

Hyperbandλ” μµκ·Ό [BOHB](https://arxiv.org/abs/1807.01774)κ°€ λ§μ΄ μ“°μ΄λ” μ¶”μ„Έμ—μ„ κ·Έ κΈ°λ°μ΄ λλ” μ¤‘μ”ν• μ•κ³ λ¦¬μ¦μ…λ‹λ‹¤. Hyperbandμ νΉμ§•μΌλ΅λ” μ΄λ΅ μ  κ·Όκ±°κ°€ ν™•μ‹¤ν• Successive Halving Algorithmμ„ κ³ λ„ν™”ν•μ€μΌλ©°, νλ‹ μ΄λ°μ— λ§¤μ° λΉ λ¥΄κ² ML λ¨λΈμ„ μλ ΄μ‹ν‚¬ μ μλ‹¤λ” μ μ…λ‹λ‹¤. λν• μ‚¬μ©ν•λ” μ…λ ¥κ°’μ„ μµμ†ν™”ν•μ—¬ ν•μ΄νΌνλΌλ―Έν„° κ³µκ°„μ„ νƒμƒ‰ν•λ” λ°μ— μμ–΄ Exploration-Exploitation Trade-offλ¥Ό μ¤„μ€λ‹¤λ” μ μ…λ‹λ‹¤.


<center>
<figure>
<img src="https://i.ibb.co/b1K74SC/hyperband-converges.png" alt="hyperband" style="zoom:50%;" />
<figcaption style="text-align: center;">Figure from [1]<br>ν•™μµ μ΄κΈ°μ—λ” λλ¤ μ„μΉ λ€λΉ„ 20λ°° λΉ λ¥΄μ§€λ§ μ¶©λ¶„ν• μ‹κ°„μ΄ μ£Όμ–΄μ΅μ„ λ• κ·Έ μ°¨μ΄κ°€ ν¬μ§€ μ•κ² λ¨.</figcaption>
</figure>
</center>

λ‹¤λ§ μ΄ μ•κ³ λ¦¬μ¦μ μ•„μ‰¬μ΄ μ μΌλ΅λ” **μ΄λ―Έ νΉμ • Bracketμ—μ„ νƒμƒ‰ν• κ²°κ³Όλ¥Ό λ‹¤λ¥Έ Bracketμ—μ„ κ·Έλ€λ΅ λ‹¤μ‹ νƒμƒ‰ν•  μλ„ μλ‹¤λ” μ **μ…λ‹λ‹¤. λ§¤ Bracketλ§λ‹¤ ν•μ΄νΌνλΌλ―Έν„° μ„¤μ •μ„ μƒλ΅ μƒν”λ§ν•μ—¬ κ°€μ Έμ¤κΈ° λ•λ¬Έμ— λ°μƒν•λ” λ¬Έμ μ…λ‹λ‹¤. λν• νλ‹ μ΄λ°μ— λΉ λ¥΄κ² μλ ΄ν•λ”λ°μ— λΉ„ν•΄ μ‹κ°„μ΄ μ¶©λ¶„ν νλ¥Έ ν›„μ—λ” κΈ°μ΅΄ λ°©λ²•λ“¤μ— λΉ„ν•΄ ν° κ°μ„ μ΄ μ—†λ‹¤λ” κ²ƒλ„ λ¬Έμ κ°€ λ©λ‹λ‹¤. μ¶”ν›„μ— λ‹¤λ£° BOHBμ—μ„λ” μ΄ λ¬Έμ λ¥Ό μ–΄λ μ •λ„ ν•΄κ²°ν•λ” κ²ƒμ„ λ³Ό μ μμµλ‹λ‹¤. λ‹¤μ ν¬μ¤νΈμ—μ„λ” BOHBμ— λ€ν•΄μ„ μ•μ•„λ³΄λ„λ΅ ν•κ² μµλ‹λ‹¤.

## λ νΌλ°μ¤

[1] [https://neptune.ai/blog/hyperband-and-bohb-understanding-state-of-the-art-hyperparameter-optimization-algorithms](https://neptune.ai/blog/hyperband-and-bohb-understanding-state-of-the-art-hyperparameter-optimization-algorithms)