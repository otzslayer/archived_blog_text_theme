---
title: ë°ì½”ë ˆì´í„°ë¥¼ ì´ìš©í•œ ê°„ë‹¨í•œ ë¡œê¹…í•˜ê¸°
tags: [decorator, logging, python]
category: Python
aside:
  toc: true
show_category: true
---

ë°ì½”ë ˆì´í„°ë¥¼ ì´ìš©í•´ì„œ í…ŒìŠ¤íŠ¸ë¥¼ ëŒ€ì²´í•  ê°„ë‹¨í•œ ë¡œê¹…ì„ í•´ë³´ê² ìŠµë‹ˆë‹¤. ğŸªµ

<!--more-->

## ğŸÂ ë°°ê²½

ê°œì¸ì ìœ¼ë¡œ ì¶”ì²œ ì‹œìŠ¤í…œì€ ë‹¤ë¥¸ ML ì• í”Œë¦¬ì¼€ì´ì…˜ë³´ë‹¤ ë„ë©”ì¸ì—ì„œ ìš”êµ¬í•˜ëŠ” ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì˜ ì–‘ì´ ë” ë§ë‹¤ê³  ìƒê°í•©ë‹ˆë‹¤. ê·¸ëŸ¬ë‹¤ë³´ë‹ˆ ì˜ˆì™¸ë¡œ ë‘ì–´ì•¼í•  ê²ƒë“¤ë„ ë” ë§ê³ , í…ŒìŠ¤íŠ¸í•´ì•¼ í•˜ëŠ” ê²ƒë“¤ë„ ë” ë§ìŠµë‹ˆë‹¤. ì§€ê¸ˆ ì œê°€ ê°œë°œí•´ì„œ ì‚¬ë‚´ì—ì„œ ìš´ì˜í•˜ê³  ìˆëŠ” í•™ìŠµê³¼ì • ì¶”ì²œ ì‹œìŠ¤í…œë„ ë§ˆì°¬ê°€ì§€ì˜€ìŠµë‹ˆë‹¤.  ë§ì€ ì¡°ê±´ë“¤ì´ ìˆì—ˆìŠµë‹ˆë‹¤. ì¶”ì²œì´ ì œê³µë˜ì–´ì•¼ í•  ì‚¬ìš©ìì— ëŒ€í•œ í•„í„°ë§ì´ ìˆì–´ì•¼ í•˜ê³ , ì¶”ì²œ ì½˜í…ì¸ ì— ëŒ€í•œ ì •ë ¬ ì¡°ê±´ì´ ìˆì–´ì•¼ í•˜ê³ , ê¶Œì¥ë˜ëŠ” ì¶”ì²œ ì½˜í…ì¸ ì˜ ê°œìˆ˜ ë“±.

ì—„ê²©í•˜ê²Œ ì§€ì¼œì ¸ì•¼ í•˜ëŠ” ì¡°ê±´ë“¤ì€ ë‹¹ì—°íˆ ìš´ì˜ ì‹œìŠ¤í…œì— ì˜¬ë¼ê°€ê¸° ì „ì— í…ŒìŠ¤íŠ¸ ë˜ì–´ì•¼ í•©ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´ ì¶”ì²œ ê²°ê³¼ì— í¬í•¨ë˜ë©´ ì•ˆë˜ëŠ” ê²ƒë“¤ì´ ìˆëŠ”ì§€ í™•ì¸í•˜ê±°ë‚˜, ì‚¬ìš©ìê°€ ì˜¬ë°”ë¥´ê²Œ í•„í„°ë§ë˜ì§€ ì•Šì•˜ëŠ”ì§€ ë§ì´ì£ . ì´ëŸ° ê²½ìš°ëŠ” ì¡°ê±´ì„ ë§Œì¡±í•˜ì§€ ëª»í•˜ëŠ” ê²½ìš° ë¹Œë“œê°€ ì•ˆë˜ê²Œ í•˜ê±°ë‚˜ ì˜¤ë¥˜ë¥¼ ë°œìƒì‹œì¼œ ìˆ˜ì •ì„ í•´ì•¼ í•©ë‹ˆë‹¤. í•˜ì§€ë§Œ ê¶Œì¥ë˜ëŠ” ì¶”ì²œ ì½˜í…ì¸ ì˜ ê°œìˆ˜ê°€ ì§€ì¼œì§€ì§€ ì•Šì€ ê²½ìš°ì— ëŒ€í•´ì„œê¹Œì§€ ì—„ê²©í•˜ê²Œ í•  í•„ìš”ëŠ” ì—†ì—ˆìŠµë‹ˆë‹¤. í™•ì¸ í›„ì— ì¡°ì¹˜ë¥¼ í•˜ë©´ ë˜ëŠ” ë¶€ë¶„ì´ë‹ˆê¹Œìš”. ëª¨ë¸ ìš´ì˜ ì¤‘ ë°œìƒí•˜ëŠ” ë¡œê·¸ì— `WARNING` ìˆ˜ì¤€ìœ¼ë¡œ ê¸°ë¡í•˜ê¸°ë§Œ í•˜ë©´ ë˜ì—ˆìŠµë‹ˆë‹¤. 

ì´ëŸ° ê²½ìš° ë°©ë²•ì€ ì—¬ëŸ¬ ê°€ì§€ì¼ê²ë‹ˆë‹¤. ë‹¨ìˆœíˆ ì¶”ì²œ ì½˜í…ì¸  ê°œìˆ˜ê°€ ê¶Œì¥í•˜ëŠ” ê°œìˆ˜ì™€ ë‹¤ë¥¸ ê²½ìš°ì—ë§Œ ë¡œê¹…ì„ í•˜ëŠ” ê²ƒë„ ë°©ë²•ì…ë‹ˆë‹¤. ì´ë²ˆ í¬ìŠ¤íŠ¸ì—ì„œëŠ” ë°ì½”ë ˆì´í„°ë¥¼ ì´ìš©í•˜ì—¬ ì¶”ìƒí™”í•œ ë¡œê¹…ì— ëŒ€í•´ ì´ì•¼ê¸° í•´ë³´ë ¤ í•©ë‹ˆë‹¤.

## ğŸ“Â  ë°ì½”ë ˆì´í„° ì‚¬ìš©í•˜ê¸°

### ê°œìš”

ê°ê°ì˜ ì¶”ì²œ ì•Œê³ ë¦¬ì¦˜ì€ í´ë˜ìŠ¤ë¡œ êµ¬ì„±ë˜ì–´ ìˆìŠµë‹ˆë‹¤. Scikit-learnì˜ ì¸í„°í˜ì´ìŠ¤ë¥¼ ë”°ë¼í•˜ê³ ì `fit()`, `generate()` ë©”ì„œë“œë¥¼ ê°–ê³  ìˆìŠµë‹ˆë‹¤. ê°ê°ì€ ë°ì´í„°ì— ë§ì¶° í•™ìŠµí•˜ê³ , ì¶”ì²œ ë¦¬ìŠ¤íŠ¸ë¥¼ ìƒì„±í•©ë‹ˆë‹¤. ê²°êµ­ ë‹¤ìŒì˜ êµ¬ì¡°ë¡œ ë°ì½”ë ˆì´í„°ë¥¼ ì‘ì„±í•˜ê³ ì í•©ë‹ˆë‹¤.

```python
logger = logging.getLogger()

class Recommender():
	def __init__(self, **kwargs):
		...
	
	def fit(self, X):
		return self._fit(X)

	@check_recommendation_validity
	def generate(self, **kwargs):
		return self._generate(**kwargs)

	...
```

### í…ŒìŠ¤íŠ¸ ìš”ì†Œ

ë¡œê¹…ì„ í†µí•´ í™•ì¸í•´ì•¼ í•  ê²ƒì€ 'ì‚¬ìš©ìì—ê²Œ ë³´ì—¬ì§€ëŠ” ì¶”ì²œ ì½˜í…ì¸ ì˜ ìˆ˜ê°€ ì‚¬ì „ì— ì •í•œ ê°œìˆ˜ì™€ ë™ì¼í•œê°€'ì™€ 'ì¶”ì²œì„ ì œê³µí•´ì•¼ í•˜ëŠ” ì‚¬ìš©ìì—ê²Œ ëª¨ë‘ ì¶”ì²œì´ ì œê³µë˜ëŠ”ê°€' ì…ë‹ˆë‹¤. 

ìš°ì„  ì²« ë²ˆì§¸ í…ŒìŠ¤íŠ¸ ìš”ì†ŒëŠ” ì¶”ì²œ ê²°ê³¼ ë‚´ì˜ ì‚¬ìš©ì ìˆ˜ì™€ ì „ì²´ ì¶”ì²œ ëª©ë¡ì˜ ê¸¸ì´ë¥¼ ì‚¬ì „ì— ì •í•œ ê°œìˆ˜ë¡œ ë‚˜ëˆˆ ê²ƒê³¼ ê°™ì€ì§€ë¥¼ í™•ì¸í•˜ë©´ ë©ë‹ˆë‹¤. ë‘ ë²ˆì§¸ ìš”ì†ŒëŠ” ì‹¤ì œ ì‚¬ìš©ì ì •ë³´ ë‚´ì˜ ì‚¬ìš©ì ìˆ˜ì™€ ì¶”ì²œ ê²°ê³¼ ë‚´ì˜ ì‚¬ìš©ì ìˆ˜ê°€ ê°™ì€ì§€ í™•ì¸í•˜ë©´ ë©ë‹ˆë‹¤.

```python
def _check_wrong_recom_size(recom_list):
	users_get_recommendation = recom_list[USER_ID].nunique()
	avg_users_over_recom_size = int(len(recom_list) / RECOM_SIZE)

	return users_get_recommendation != avg_users_over_recom_size

def _check_every_user_get_recommendation(user_info, recom_list):
	num_users = len(user_info)
	users_get_recommendation = recom_list[USER_ID].nunique()

	return num_users == users_get_recommendation
```

### ë°ì½”ë ˆì´í„° ì‘ì„±

ë°ì½”ë ˆì´í„°ë¥¼ ì‘ì„±í•´ì•¼ í•©ë‹ˆë‹¤. ë°ì½”ë ˆì´í„°ì— ëŒ€í•œ ìì„¸í•œ ì„¤ëª…ì€ ë³¸ í¬ìŠ¤íŠ¸ì—ì„œ ë‹¤ë£¨ì§€ ì•Šê² ìŠµë‹ˆë‹¤. ë‹¤ìŒ [ë§í¬](https://wikidocs.net/83687)ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.

ìœ„ì—ì„œ ì‘ì„±í•œ ë‘ ê°œì˜ í•¨ìˆ˜ë¥¼ í¬í•¨í•˜ì—¬ ì‘ì„±ì„ í• í…ë° ì•Œì•„ë‘ì–´ì•¼ í•  ì ì´ ìˆìŠµë‹ˆë‹¤. ì¼ë‹¨ ì‚¬ìš©í•  ë°ì½”ë ˆì´í„°ëŠ” í´ë˜ìŠ¤ ë‚´ì—ì„œ ì‚¬ìš©í•©ë‹ˆë‹¤. ë”°ë¼ì„œ ë°ì½”ë ˆì´í„° ë‚´ì˜ Wrapper í•¨ìˆ˜ì— `self`ë¥¼ ì¸ìë¡œ ë°›ìœ¼ë©´ í´ë˜ìŠ¤ ë‚´ì˜ ì¸ìŠ¤í„´ìŠ¤ì— ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. í˜„ì¬ ì‹œìŠ¤í…œì—ì„œ ì‚¬ìš©ì ì •ë³´ì˜ ê²½ìš° í´ë˜ìŠ¤ ë‚´ì˜ ì¸ìŠ¤í„´ìŠ¤ë¼ `self`ë¥¼ ì¶”ê°€í•´ì£¼ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.

Wrapper í•¨ìˆ˜ì˜ ì¸ìì— ë“¤ì–´ê°ˆ ë©”ì„œë“œëŠ” ì¶”ì²œ ê²°ê³¼ë¥¼ ìƒì„±í•˜ëŠ” ë©”ì„œë“œì…ë‹ˆë‹¤. `generate()` ë©”ì„œë“œê°€ ì‚¬ìš©ë  ê²ƒì„ ê°ì•ˆí•˜ì—¬ ì‘ì„±í•©ë‹ˆë‹¤.

```python
def check_recommendation_validity(generator) -> Callable:
    @functools.wraps(generator)
    def wrapper(self, *args, **kwargs):
        recom_list = generator(self, *args, **kwargs)
    
        if _check_wrong_recom_size(recom_list):
            msg = "There are too many or too few recommendations for each user."
            logger.warning(msg)
        
        if not _check_every_user_get_recommendation(
            user_info=self._user_info, recom_list=recom_list
        ):
            msg = (
                "The user coverage is not 100%."
                "There are users cannot get recommendation."
            )
            logger.warning(msg)
        return recom_list
    return wrapper

```

### ê²°ê³¼ í™•ì¸

ì´ë ‡ê²Œ ì½”ë“œë¥¼ ë‹¤ ì‘ì„±í•˜ê³  ë‚˜ì„œ ì¶”ì²œ ë¦¬ìŠ¤íŠ¸ë¥¼ ìƒì„±í•©ë‹ˆë‹¤. ë°ì½”ë ˆì´í„°ê°€ ì˜¬ë°”ë¥´ê²Œ ì‘ì„±í•˜ëŠ”ì§€ í™•ì¸í•˜ê¸° ìœ„í•´ì„œ ì¼ë¶€ëŸ¬ ì¶”ì²œ ê²°ê³¼ë¥¼ ì¼ë¶€ë§Œ ë°˜í™˜í•˜ê²Œ í•´ë´¤ìŠµë‹ˆë‹¤. ë¡œê¹…ì´ ì˜¬ë°”ë¥´ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.

![](/assets/images/2021-11-30-simple-logging-using-decorator/result.png)