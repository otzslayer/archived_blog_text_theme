---
title: Dataset Shiftì— ëŒ€í•˜ì—¬ (1)
tags: [dataset-shift, covariate-shift, prior-probability-shift]
category: ML
aside:
  toc: true
show_category: true
---

Dataset ShiftëŠ” ë¬´ì—‡ì¸ì§€, ì–´ë–¤ ê²ƒë“¤ì´ ìˆëŠ”ì§€ ì•Œì•„ë´…ì‹œë‹¤. ğŸ‘€

<!--more-->

ì „ì²´ ë‚´ìš©ì´ ë„ˆë¬´ ê¸¸ì–´ ë‘ ê°œë¡œ ë‚˜ëˆ  í¬ìŠ¤íŒ…í•  ì˜ˆì •ì…ë‹ˆë‹¤. â˜ºï¸ 
1ë¶€ì—ì„œëŠ” Dataset Shiftê°€ ë¬´ì—‡ì´ë©° ì–´ë–¤ ì¢…ë¥˜ê°€ ìˆëŠ”ì§€, Covariate Shiftì™€ Prior Probability Shiftê°€ ë¬´ì—‡ì¸ì§€ ë‹¤ë£¹ë‹ˆë‹¤.
2ë¶€ì—ì„œëŠ” Concept Shiftì— ëŒ€í•œ ë‚´ìš©ì„ ë‹¤ë£¹ë‹ˆë‹¤.

## ë“¤ì–´ê°€ë©°

ML í”„ë¡œì íŠ¸ë¥¼ í•˜ë‹¤ë³´ë©´ ë§¤ìš° ê¸´ ì‹œê°„ ë™ì•ˆì˜ ë°ì´í„°ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²½ìš°ê°€ ë§ìŠµë‹ˆë‹¤. ê¸´ ì‹œê°„ì˜ ë°ì´í„°ì—ì„  ëª¨ë“  ë³€ìˆ˜ì™€ ëª¨ë“  íƒ€ê²Ÿê°’ì´ ë³€í™”ê°€ ì—†ê¸´ ë§¤ìš° í˜ë“­ë‹ˆë‹¤. ê°„ë‹¨í•œ ì˜ˆë¥¼ ë“¤ì–´ë³¼ê¹Œìš”? ì–´ë–¤ íšŒì‚¬ì—ì„œ ì§ì›ë“¤ì˜ ë°ì´í„°ë¥¼ ì´ìš©í•˜ì—¬ ê° ì§ì›ë“¤ì˜ í‡´ì§ í™•ë¥ ì„ ì˜ˆì¸¡í•˜ê³ ì í•©ë‹ˆë‹¤. ìµœê·¼ 2ë…„ê°„ì˜ ë°ì´í„°ë¥¼ ì‚¬ìš©í•´ ëª¨ë¸ì„ ë§Œë“¤ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤. ì§ì›ë“¤ì˜ í‡´ì§ë„ ê²°êµ­ íŠ¸ë Œë“œë¼ëŠ” ê²ƒì´ ìˆê¸° ë•Œë¬¸ì— í•™ìŠµ/ê²€ì¦ ë°ì´í„°ë¥¼ ì‹œê°„ ìˆœ (1ë…„ ê¸°ì¤€)ìœ¼ë¡œ ë‚˜ëˆ´ë‹¤ê³  ê°€ì •í•´ë³´ì£ . 

ëª¨ë¸ì— ì‚¬ìš©ëœ ë°ì´í„°ì—ëŠ” ì—¬ëŸ¬ í”¼ì²˜ê°€ ìˆì„ê²ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´ ê²½ìŸì‚¬ ëŒ€ë¹„ ì—°ë´‰ ê°™ì€ ê²ƒë„ ìˆê² ì£ . í•˜ì§€ë§Œ ê²½ìŸì‚¬ ëŒ€ë¹„ ì—°ë´‰ì„ ì‚´í´ë³´ë˜ ì¤‘ ì´ìƒí•œ ì ì„ ë°œê²¬í•©ë‹ˆë‹¤. **2ë…„ ì „ì˜ ê²½ìŸì‚¬ ëŒ€ë¹„ ì—°ë´‰ì€ ë‚®ì§€ ì•Šì•˜ëŠ”ë°, 1ë…„ ì „ì˜ ê²½ìŸì‚¬ ëŒ€ë¹„ ì—°ë´‰ì€ ë§¤ìš° ë‚®ì•˜ìŠµë‹ˆë‹¤.** ì•Œì•„ë³´ë‹ˆ ê²½ìŸì‚¬ì˜ ì—°ë´‰ì´ íŒŒê²©ì ìœ¼ë¡œ ì˜¬ëë˜ê±°ì£ . 1ë…„ ì‚¬ì´ì— í•´ë‹¹ í”¼ì²˜ê°’ì€ ë¯¿ê¸°ì§€ ì•Šì„ ë§Œí¼ ë°”ë€Œì—ˆìŠµë‹ˆë‹¤. ì´ë ‡ê²Œ í•™ìŠµ ë°ì´í„°ì™€ í…ŒìŠ¤íŠ¸ ë°ì´í„°ì˜ í”¼ì²˜, ë˜ëŠ” íƒ€ê²Ÿê°’ì˜ ë¶„í¬ê°€ ë‹¤ë¥¸ ìƒí™©ì„ **Dataset Shift** ë¼ê³  í•©ë‹ˆë‹¤.

> *Dataset shift is a challenging situation where the joint distribution of inputs and outputs differs between the training and test stages. --  [Dataset Shift, The MIT Press](https://cs.nyu.edu/~roweis/papers/invar-chapter.pdf)*
> 

Dataset ShiftëŠ” ì…ë ¥ í”¼ì²˜ê°’ì´ í™œìš©ë˜ëŠ” ë°©ì‹, í•™ìŠµ ë°ì´í„°ì™€ í…ŒìŠ¤íŠ¸ ë°ì´í„°ë¥¼ ì„ ì •í•˜ëŠ” ë°©ì‹, ë°ì´í„°ì˜ í¬ì†Œì„±, ë¹„ì •ìƒì (non-stationary)ì¸ í™˜ê²½ìœ¼ë¡œ ì¸í•œ ë°ì´í„° ë³€í™” ë“±ìœ¼ë¡œ ì¸í•´ ë°œìƒí•©ë‹ˆë‹¤.  Dataset ShiftëŠ” ë‹¨ìˆœí•œ ê°œë…ì¼ ìˆ˜ ìˆì§€ë§Œ ML ëª¨ë¸ í•™ìŠµì€ ë¬¼ë¡ ì´ê³  íŠ¹íˆ ML í”„ë¡œë•ì…˜ì—ì„  êµ‰ì¥íˆ ì¤‘ìš”í•œ ì£¼ì œì…ë‹ˆë‹¤. ìš´ì˜ ì¤‘ì¸ ML ëª¨ë¸ì—ì„œ Dataset Shiftê°€ ë°œìƒí•œë‹¤ë©´ ë‹¹ì—°íˆ ëª¨ë¸ ì„±ëŠ¥ í•˜ë½ì´ ë°œìƒí•˜ê²Œ ë˜ê³  **Model Staleness**ê°€ ë°œìƒí•˜ëŠ” ê°€ì¥ ì£¼ìš” ì›ì¸ì´ ë˜ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.

## Dataset Shift

<figure>
  <img src='/assets/images/2021-11-19-about-dataset-shift-1/dataset_shift.png'>
  <figcaption style="text-align: center;">Image from [1]</figcaption>
</figure>


Dataset Shiftì„ ë‹¤ë£¨ëŠ” ë§ì€ ì•„í‹°í´, ë…¼ë¬¸ë§ˆë‹¤ ì •ì˜í•˜ëŠ” ë°©ì‹ì´ ë„ˆë¬´ë‚˜ ë‹¤ë¦…ë‹ˆë‹¤. ê·¸ë˜ì„œ ë³¸ í¬ìŠ¤íŠ¸ì—ì„œëŠ” ì—¬ëŸ¬ ìë£Œë“¤ì„ ì •ë¦¬í•˜ì—¬ ë˜ë„ë¡ ì¼ë°˜ì ì¸ ë°©ì‹ìœ¼ë¡œ ë¶„ë¥˜í•´ë³´ê³ ì í•©ë‹ˆë‹¤. ìš°ì„  Dataset ShiftëŠ” ìœ„ì—ì„œ ì„¤ëª…ë“œë¦° ê²ƒì²˜ëŸ¼ í•™ìŠµ ë°ì´í„°ì™€ í…ŒìŠ¤íŠ¸ ë°ì´í„°ì˜ ê²°í•© ë¶„í¬ (Joint Distribution)ì´ ë‹¤ë¥¼ ë•Œ ë‚˜íƒ€ë‚©ë‹ˆë‹¤. ìˆ˜í•™ì ìœ¼ë¡œ í‘œí˜„í•œë‹¤ë©´ ì´ë ‡ìŠµë‹ˆë‹¤.

$$P_{tr}(X, y) \neq P_{ts} (X, y)$$

Dataset ShiftëŠ” ë°œìƒ ì›ì¸, í˜„ìƒ ë“±ì„ ê·¼ê±°ë¡œ í¬ê²Œ ì„¸ ê°€ì§€ë¡œ ë¶„ë¥˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

- Covariate Shift
- Prior Probability Shift
- Concept Shift
    - Gradual Concept Drift
    - Sudden Concept Drift
    - Recurring Concept Drift

ë” ì„¸ë¶„í™”í•˜ì—¬ êµ¬ë¶„í•˜ëŠ” ê²½ìš°ë„ ìˆìŠµë‹ˆë‹¤. Batch Normalization ë…¼ë¬¸ê³¼ í•¨ê»˜ ìœ ëª…í•´ì§„ Internal Covariate Shiftë„ ê·¸ ì¤‘ í•˜ë‚˜ì…ë‹ˆë‹¤. í•˜ì§€ë§Œ ML/DL ëª¨ë‘ì— ëŒ€í•´ ì¼ë°˜ì ì¸ ê²½ìš°ë§Œ ë‹¤ë£¨ê¸° ìœ„í•´ ë³¸ í¬ìŠ¤íŠ¸ì—ì„œëŠ” ë‹¤ë£¨ì§€ ì•Šê² ìŠµë‹ˆë‹¤.

### Covariate Shift

> *Covariate shift is a simpler particular case of dataset shift where only the input distribution changes, while the conditional distribution of the outputs given the inputs $p(y \mid x)$ remains unchanged. â€”- [Dataset Shift, The MIT Press](https://cs.nyu.edu/~roweis/papers/invar-chapter.pdf)*
> 

<figure>
  <img src='/assets/images/2021-11-19-about-dataset-shift-1/covariate_shift.png'>
  <figcaption style="text-align: center;">Image from [2]</figcaption>
</figure>

Covariate ShiftëŠ” ì…ë ¥ í”¼ì²˜ì™€ ë ˆì´ë¸”ê³¼ì˜ ê´€ê³„ëŠ” ê·¸ëŒ€ë¡œì¸ ë°˜ë©´ ì…ë ¥ í”¼ì²˜ë“¤ì˜ ë¶„í¬ê°€ ë‹¤ë¥¸ í˜„ìƒì„ ë§í•©ë‹ˆë‹¤. ì…ë ¥ ë°ì´í„°ì˜ ë¶„í¬ê°€ ë ˆì´ë¸”ì„ ì˜ ë°˜ì˜í•˜ì§€ ëª»í•˜ëŠ” ê²½ìš°ì— ë§ì´ ë°œìƒí•©ë‹ˆë‹¤.

$$P_{tr}(Y \mid X) = P_{ts} (Y \mid X) \quad \text{and} \quad P_{tr}(X) \neq P_{ts}(X)$$

Covariate Shiftê°€ ë°œìƒí•˜ëŠ” ì£¼ìš” ì›ì¸ì€ í¬ê²Œ ë‘ ê°€ì§€ë¡œ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. [4]

- Sample Selection Bias
    - ë°ì´í„° ìˆ˜ì§‘ ê³¼ì •ì—ì„œ ë°œìƒí•˜ëŠ” ì‹œìŠ¤í…œì ì¸ ê²°í•¨ì…ë‹ˆë‹¤. ì´ ê²½ìš°ì—” í•™ìŠµ ë°ì´í„°ë¥¼ ëª¨ì§‘ë‹¨ì—ì„œ ê· ì¼í•˜ì§€ ëª»í•˜ê²Œ ì„ íƒí•˜ì—¬ ë°œìƒí•˜ê²Œ ë©ë‹ˆë‹¤.
- Non-stationary Environments
    - í•™ìŠµ í™˜ê²½ì´ í…ŒìŠ¤íŠ¸ í™˜ê²½í•˜ê³  ë‹¤ë¥¼ ë•Œ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë³´í†µ ì‹œê°„ì  ë˜ëŠ” ê³µê°„ì  ë³€í™”ë¡œ ì¸í•´ ë°œìƒí•©ë‹ˆë‹¤.

ì–´ë–¤ ì§‘ë‹¨ì˜ íì•” ë°œë³‘ë¥ ì„ ì˜ˆì¸¡í•œë‹¤ê³  ê°€ì •í•´ë´…ì‹œë‹¤. ë°ì´í„°ì— ë§ì€ í”¼ì²˜ê°€ ìˆì§€ë§Œ ê·¸ ì¤‘ì— í¡ì—°ëŸ‰ì— ëŒ€í•œ í”¼ì²˜ê°€ ìˆìŠµë‹ˆë‹¤. í¡ì—°ëŸ‰ì´ ë†’ì„ ìˆ˜ë¡ íì•” ë°œë³‘ë¥ ì´ ë†’ì•„ì§„ë‹¤ëŠ” ê²ƒì€ ì˜ ì•Œë ¤ì§„ ê´€ê³„ì…ë‹ˆë‹¤. ìµœì´ˆ ëª¨ë¸ì„ í•™ìŠµí•  ë•Œì—ëŠ” í•´ë‹¹ ì§‘ë‹¨ì˜ í‰ê· ì ì¸ í¡ì—°ëŸ‰ì´ ë§¤ìš° ë‚®ì•˜ìŠµë‹ˆë‹¤. ê·¸ëŸ¬ë‹¤ë³´ë‹ˆ í¡ì—°ëŸ‰ì´ ë†’ì€ ì§‘ë‹¨ì— ëŒ€í•œ í•™ìŠµì€ ë§ì´ ì´ë£¨ì–´ì§€ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.. ê·¸ëŸ¼ì—ë„ í•™ìŠµ ì„±ëŠ¥ì€ ë§¤ìš° ì¢‹ì•˜ìŠµë‹ˆë‹¤. ì‹œê°„ì´ í˜ëŸ¬ ë™ì¼ ì§‘ë‹¨ì— ëŒ€í•´ ë‹¤ì‹œ íì•” ë°œë³‘ë¥ ì„ ì˜ˆì¸¡í•˜ë ¤ í–ˆëŠ”ë°, ì´ë²ˆì—ëŠ” í¡ì—°ëŸ‰ì´ ê³¼ê±°ì— ë¹„í•´ ì „ì²´ì ìœ¼ë¡œ ë†’ì•„ì¡ŒìŠµë‹ˆë‹¤. **í¡ì—°ëŸ‰ì´ ë†’ì•„ì§ì— ë”°ë¼ íì•” ë°œë³‘ë¥ ì´ ë†’ì•„ì§„ë‹¤ëŠ” ê´€ê³„ëŠ” ë³€í•¨ì´ ì—†ì§€ë§Œ ë†’ì€ í¡ì—°ëŸ‰ì— ëŒ€í•œ í•™ìŠµì´ ì˜ ì´ë£¨ì–´ì§€ì§€ ì•Šì•˜ê¸° ë•Œë¬¸ì— ì˜ˆì¸¡ì— ëŒ€í•œ ì„±ëŠ¥ì´ ê¸‰ê²©íˆ ë‚®ì•„ì¡ŒìŠµë‹ˆë‹¤.**

ë‹¤ë¥¸ ì˜ˆë¡œëŠ” ì´ë¯¸ì§€ ë¶„ë¥˜ê°€ ìˆëŠ”ë°ìš”. ì˜¤ë Œì§€, íŒŒì¸ì• í”Œ, ë°”ë‚˜ë‚˜ ì‚¬ì§„ë“¤ì„ í•™ìŠµí•˜ì—¬ ë¶„ë¥˜í•˜ëŠ” ë„¤íŠ¸ì›Œí¬ë¥¼ ë§Œë“ ë‹¤ê³  ê°€ì •í•´ë´…ì‹œë‹¤. í•™ìŠµ ë°ì´í„°ì—ì„  ì˜¤ë Œì§€, íŒŒì¸ì• í”Œ ì‚¬ì§„ì´ ë§ì•˜ê³  í•™ìŠµ ì„±ëŠ¥ë„ ë‹¹ì—°íˆ ë” ì¢‹ì•˜ìŠµë‹ˆë‹¤. ê·¸ëŸ°ë° ì‹¤ì œ í…ŒìŠ¤íŠ¸ì…‹ì—ëŠ” ë°”ë‚˜ë‚˜ ì‚¬ì§„ë“¤ì´ ë§ì´ ìˆì—ˆê³  ê²°êµ­ í•™ìŠµ ëŒ€ë¹„ í…ŒìŠ¤íŠ¸ ì„±ëŠ¥ì´ ë§¤ìš° ë‚®ì•„ì§€ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤. ì´ ì—­ì‹œ ì…ë ¥ ë°ì´í„°ì— ëŒ€í•œ ë ˆì´ë¸”ì˜ ê´€ê³„ëŠ” ë°”ë€Œì§€ ì•Šì•˜ì§€ë§Œ ì…ë ¥ ë°ì´í„°ì˜ ë¶„í¬ê°€ ë‹¬ë¼ì§„ ê²½ìš°ì…ë‹ˆë‹¤.

Covariate Shiftì— ëŒ€í•´ ê°•ê±´í•œ ëª¨ë¸ì„ ë§Œë“¤ê¸° ìœ„í•´ì„œëŠ” í•­ìƒ ì¸í’‹ í”¼ì²˜ë“¤ì´ ì•ˆì •ì ì¸ì§€ í™•ì¸í•´ì•¼ í•©ë‹ˆë‹¤. ëª¨ë¸ í•™ìŠµ ë‹¨ê³„ì—ì„œ í”¼ì²˜ë“¤ì˜ ê°’ì´ ë³€í™”í•  ê°€ëŠ¥ì„±ì´ ìˆëŠ”ì§€ ê²€ì¦í•˜ì—¬ì•¼ í•©ë‹ˆë‹¤. íŠ¹íˆ Cross-validationì„ ìˆ˜í–‰í•  ë•Œ êµ‰ì¥íˆ í¸í–¥ëœ ê²°ê³¼ë¥¼ ì´ˆë˜í•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì— ì£¼ì˜í•´ì•¼ í•©ë‹ˆë‹¤. ëª¨ë¸ì„ ì„œë¹™í•˜ê¸° ì‹œì‘í–ˆë”ë¼ë„ ê¾¸ì¤€í•œ ëª¨ë‹ˆí„°ë§ì„ ìˆ˜í–‰í•´ì•¼ í•©ë‹ˆë‹¤.

### Prior Probability Shift

> *Prior probability shift appears only in $Y \to X$ problems, and is defined as the case where $P_{tr}(X \mid Y) = P_{ts}(X \mid Y)$ and $P_{tr}(Y) \neq P_{ts}(Y)$. â€”  [Herrera, Francisco. "Dataset shift in classification: Approaches and problems."Â International work-conference on artificial neural networks (IWANN). 2011.](http://iwann.ugr.es/2011/pdf/InvitedTalk-FHerrera-IWANN11.pdf)*


<figure>
  <img src='/assets/images/2021-11-19-about-dataset-shift-1/prior_probability_shift.png'>
  <figcaption style="text-align: center;">Image from [3]</figcaption>
</figure>

Prior Probability ShiftëŠ” ì…ë ¥ í”¼ì²˜ì™€ ë ˆì´ë¸”ê³¼ì˜ ê´€ê³„ëŠ” ì—­ì‹œ ê·¸ëŒ€ë¡œì§€ë§Œ ë ˆì´ë¸”ì˜ ë¶„í¬ê°€ ë‹¬ë¼ì§€ëŠ” í˜„ìƒì„ ë§í•©ë‹ˆë‹¤. ë°ì´í„° ë¶ˆê· í˜• ë¬¸ì œë¥¼ ìƒê°í•´ë³´ë©´ ì‰½ê²Œ ì´í•´í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. í•™ìŠµ ë°ì´í„°ì—ì„œ ìŠ¤íŒ¸ ë©”ì¼ì— ëŒ€í•œ ì‚¬ì „ í™•ë¥  (Prior Probability)ê°€ 50%ë¼ê³  ê°€ì •í•´ë´…ì‹œë‹¤. ê·¸ëŸ¬ë©´ ìš°ë¦¬ëŠ” í•™ìŠµ ë°ì´í„°ì— 50%ì˜ ìŠ¤íŒ¸ ë©”ì¼ê³¼ 50%ì˜ ì •ìƒ ë©”ì¼ì´ ìˆë‹¤ê³  ê°€ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ í˜„ì‹¤ì—ì„  ëŒ€ë¶€ë¶„ì˜ ë©”ì¼ì´ ìŠ¤íŒ¸ì…ë‹ˆë‹¤. ì´ ê²½ìš°ì—” ë ˆì´ë¸”ì˜ ë¶„í¬ê°€ ë³€í•˜ê²Œ ë©ë‹ˆë‹¤. ì‚¬ì „ í™•ë¥ ì˜ ë¶„í¬ê°€ ë‹¬ë¼ì§€ê²Œ ë˜ì£ . í•˜ì§€ë§Œ ì…ë ¥ í”¼ì²˜ë“¤ì— ëŒ€í•œ ë¶„í¬ëŠ” ë³€í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

ì´ í˜„ìƒì€ ì˜¤ì§ $Y \to X$ ë¬¸ì œì—ì„œë§Œ ë°œìƒí•˜ë©°, ë‚˜ì´ë¸Œ ë² ì´ì¦ˆ (NÃ¤ive Bayes)ê°€ Prior Probability Shiftì˜ ê°€ì¥ ì¢‹ì€ ì˜ˆì‹œì…ë‹ˆë‹¤.

## References

[1] Stewart, M. (Dec 21, 2019). Understanding Dataset Shift. https://towardsdatascience.com/understanding-dataset-shift-f2a5a262a766

[2] Berkowitz, J. (Mar 23, 2021). Distribution Shift and Audio Data. https://www.iqt.org/distribution-shift-and-audio-data/

[3] QuiÃ±onero-Candela, J., Sugiyama, M., Lawrence, N. D., & Schwaighofer, A. (Eds.). (2009). Dataset shift in machine learning. Mit Press.

[4] Das, S. (Nov 8, 2021). Best Practices for Dealing With Concept Drift. https://neptune.ai/blog/concept-drift-best-practices